У МЕНЯ УЖЕ ЕСТЬ РАБОТАЮЩЕЕ ПРИЛОЖЕНИЕ: Spring Boot (Java) + Spring Security + файловое хранилище ./data + фронт HTML/CSS/Vanilla JS.
ОНО УЖЕ УМЕЕТ: дерево слева, просмотр/редактирование exercise.json и notes.md, загрузка/удаление файлов в media, стриминг с Range, мобильная панель, тёмная тема, breadcrumbs, режим просмотра папки справа.

НУЖНО СДЕЛАТЬ НОВУЮ ИТЕРАЦИЮ (UI+RBAC+метаданные файлов), НЕ ЛОМАЯ СУЩЕСТВУЮЩЕЕ, А АККУРАТНО РАСШИРИВ.

========================================
1) УБРАТЬ МИНИ-КНОПКИ ИЗ ЛЕВОГО ДЕРЕВА
========================================
СЕЙЧАС: в левом дереве возле папок есть маленькие кнопки типа “+S”, “+E”, rename и т.п.
НАДО:
- Полностью убрать любые кнопки действий из левой панели дерева.
- Слева остаётся только навигация: раскрыть/свернуть и выбор папки/упражнения.

ДЕЙСТВИЯ ДОБАВИТЬ/ПЕРЕИМЕНОВАТЬ/УДАЛИТЬ ДОЛЖНЫ БЫТЬ СПРАВА (в правой панели) в зависимости от того, что открыто (папка или упражнение) И/ИЛИ в общих кнопках.

========================================
2) ПОВЕДЕНИЕ ПО УМОЛЧАНИЮ ПРИ СТАРТЕ
========================================
При открытии приложения (после логина), если ничего не выбрано:
- справа должен показываться “нулевой уровень” — список папок первого уровня (корневые разделы внутри ./data).
То есть режим VIEW_SECTION для rootPath="" или специальный режим “Главная”.

Левая панель при этом просто показывает дерево, а справа — “Список разделов верхнего уровня”.

========================================
3) РЕСАЙЗ ЛЕВОЙ ПАНЕЛИ МЫШКОЙ
========================================
Добавь вертикальный “разделитель” между левой и правой панелью.
- На десктопе: пользователь тянет мышью (drag) и меняет ширину левой панели.
- Ограничения: min 220px, max 600px (примерно).
- Сохраняй ширину в localStorage (например key: kf_sidebar_width_v1) и восстанавливай при загрузке.
- На мобиле/узком экране (drawer) ресайз не нужен.

========================================
4) ПОЛНАЯ РУСИФИКАЦИЯ UI
========================================
Все надписи, кнопки, заголовки, подсказки, сообщения ошибок на UI — на русском.
Примеры:
- “Открыть”, “Скачать”, “Удалить”, “Сохранить”, “Добавить папку”, “Добавить упражнение”, “Переименовать”, “Отмена”, “Войти”, “Выйти”, “Настроить”, “Админка”, “Пользователи”, “Добавить пользователя”, “Сменить пароль”, “Права”, “Администратор”, “Редактирование”, “Только просмотр”, “Описание файла”, “Изменить описание”, “Сохранить изменения” и т.п.
Убери слово “Навигатор” вообще (не показывать).
Кнопку “Плюс секция” (добавить раздел) перенеси вниз (см. пункт 6).

========================================
5) ОПИСАНИЯ ДЛЯ ФАЙЛОВ (МЕТАДАННЫЕ ФАЙЛОВ)
========================================
СЕЙЧАС: файлы — просто список имен.
НАДО:
- У каждого файла в упражнении должно быть текстовое описание (комментарий).
- На UI рядом с каждым файлом показать:
  - имя файла
  - кнопки: “Открыть” (или предпросмотр), “Скачать”, “Удалить”
  - блок “Описание: ...”
  - кнопка “Изменить” (Edit) для описания
  - при редактировании: поле ввода + “Сохранить”/“Отмена”

ГДЕ ХРАНИТЬ ОПИСАНИЯ:
- Добавь в папку упражнения файл metadata.json (или files.json) рядом с exercise.json и notes.md.
Например:
data/.../ExerciseName/
  exercise.json
  notes.md
  media/
  files.json

Формат files.json:
{
  "files": [
    {
      "fileName": "2026-02-07_front.mp4",
      "description": "Фронтальный ракурс, медленно",
      "createdAt": "2026-02-07T12:00:00Z",
      "updatedAt": "2026-02-07T12:00:00Z"
    }
  ]
}

Требования:
- При загрузке файлов (upload) — автоматически добавляй запись в files.json с пустым description.
- Если файл удалён — удаляй запись из files.json.
- Если файл переименован системой (суффиксы (1)(2)) — в files.json сохраняй фактическое имя.
- Если files.json отсутствует — создавай автоматически при первом обращении.
- Если в media/ есть файлы, которых нет в files.json — при чтении автоматически “досинхронизируй” (добавь записи с пустым описанием).
- Если в files.json есть записи на отсутствующие файлы — при чтении чисти.

Новые API (минимально, аккуратно):
- GET /api/exercises?path=... должен возвращать files[] включая description.
- PUT /api/files/description?exercisePath=...&fileName=...
  body: { "description": "..." }
  -> обновляет files.json.

========================================
6) ПРАВЫЕ КНОПКИ ДЛЯ ДОБАВЛЕНИЯ (ВМЕСТО ЛЕВЫХ)
========================================
- Убрать сверху слева “Навигатор” и любые заголовки, чтобы не занимало место.
- Кнопку добавления раздела (раньше “Плюс секция”) перенести вниз: сделай плавающую кнопку (FAB) или кнопку внизу панели.
Требование: “кнопочку добавления секции сделай снизу, снизу справа”.
Сделай внизу справа (по экрану) круглую кнопку “+” (FAB).
При нажатии — открыть меню:
  - “Добавить папку”
  - “Добавить упражнение” (если сейчас открыт раздел; если открыт root — тоже можно добавить корневой раздел)
Если сейчас открыт УПРАЖНЕНИЕ, то “Добавить упражнение” относится к родительскому разделу (покажи подсказку).

В правой панели:
- Если открыт раздел: показывай кнопки “Добавить папку” и “Добавить упражнение”, “Переименовать раздел”, “Удалить раздел” (в зависимости от прав).
- Если открыто упражнение: показывай “Переименовать упражнение”, “Удалить упражнение” + блоки редактирования текста/заметок/файлов (в зависимости от прав).

========================================
7) РОЛИ И ПРАВА ПОЛЬЗОВАТЕЛЕЙ (3 УРОВНЯ)
========================================
Надо реализовать пользователей с правами:
- Администратор (admin=true)
- Редактирование (canEdit=true)
- Только просмотр (canEdit=false)
Правило:
- Если admin=true -> видит кнопку “Админка” и может управлять пользователями.
- Если canEdit=true -> может редактировать упражнения/разделы/файлы (все действия CRUD).
- Если canEdit=false -> скрыть/отключить ВСЕ кнопки редактирования/добавления/удаления/переименования/загрузки. Оставить только просмотр и скачивание/открытие файлов.

ВАЖНО: Админ может быть и canEdit=false? Допусти оба флага независимо. Но обычно admin должен иметь canEdit=true по умолчанию при создании.

ХРАНЕНИЕ ПОЛЬЗОВАТЕЛЕЙ
СЕЙЧАС: users.txt формат login:password
НАДО: расширить формат, но оставить совместимость.
Сделай новый файл users.json (рекомендовано) и миграцию:
- При старте:
  - Если есть users.json -> использовать его.
  - Иначе, если есть users.txt -> импортировать в users.json с admin=false, canEdit=true по умолчанию (кроме ai:1 — сделай admin=true, canEdit=true).
  - После импорта users.txt можно оставить как бэкап, но приложение должно работать по users.json.

Формат users.json:
{
  "users": [
    { "login": "ai", "password": "1", "admin": true, "canEdit": true }
  ],
  "updatedAt": "..."
}

Пароли пока можно хранить открыто (простота), но сделай аккуратный слой UsersService.

АВТОРИЗАЦИЯ SPRING SECURITY
- При логине загружай users.json в memory userDetails.
- Нужно, чтобы изменения из админки применялись без перезапуска:
  - реализуй UserDetailsService, который читает users.json каждый раз (с кэшем на 2-5 секунд) ИЛИ с FileWatcher, но проще кэш.
- Роли/авторизации:
  - ROLE_ADMIN для admin=true
  - ROLE_EDITOR для canEdit=true
  - Без ROLE_EDITOR -> только read endpoints.
- Ограничь API:
  - Просмотр: разрешить всем авторизованным.
  - Редактирование/создание/удаление: только ROLE_EDITOR.
  - Управление пользователями: только ROLE_ADMIN.

========================================
8) АДМИНКА ПОЛЬЗОВАТЕЛЕЙ (UI + API)
========================================
В верхней части справа добавь кнопку “Админка” (видна только admin=true).
При нажатии открывается экран админки:
- Таблица/список пользователей:
  - login
  - password (скрыт по умолчанию, кнопка “Показать пароль” для конкретного пользователя)
  - галочки: “Администратор”, “Редактирование”
  - кнопки: “Сменить пароль”, “Удалить”
- Сверху/снизу: “Добавить пользователя”
  - login
  - password
  - галочки admin/canEdit
  - кнопка “Сохранить”

Сохранение:
- Все изменения записываются в users.json.
- После сохранения права должны начать действовать сразу.

Ограничения:
- Нельзя удалить последнего администратора (должен остаться хотя бы один admin=true).
- Нельзя удалить текущего пользователя без подтверждения.
- При изменении своего пароля — оно обновляет запись и требует переавторизации (или просто остаётся в сессии, но следующий логин уже по новому паролю).

Новые API:
- GET /api/admin/users (ROLE_ADMIN)
- POST /api/admin/users (ROLE_ADMIN) body: {login,password,admin,canEdit}
- PUT /api/admin/users (ROLE_ADMIN) body: {login,password?,admin?,canEdit?}
- DELETE /api/admin/users?login=... (ROLE_ADMIN)
- POST /api/me/change-password body: {oldPassword,newPassword} (любой авторизованный)

Важно:
- В /api/me/change-password проверять oldPassword корректность.
- Для admin endpoints не отдавай пароли в списке открыто, либо:
  - отдавай passwordMasked="******"
  - отдельный endpoint GET /api/admin/users/password?login=... -> {password:"..."} (ROLE_ADMIN)
  ЛИБО возвращай пароль, но UI скрывает. Предпочтительнее отдельный endpoint “показать пароль”.

========================================
9) КНОПКА “НАСТРОИТЬ” ДЛЯ СМЕНЫ СВОЕГО ПАРОЛЯ
========================================
Сверху справа рядом с “Выйти”:
- слева от “Выйти” добавь кнопку “Настроить”.
- При нажатии открывается модалка:
  - старый пароль
  - новый пароль
  - повтор нового пароля
  - “Сохранить”
- Использует endpoint /api/me/change-password.
- После успешной смены: покажи сообщение “Пароль изменён”.

========================================
10) ОБНОВЛЕНИЯ FRONTEND STATE
========================================
- При старте показывай root view (список корневых папок).
- Состояние дерева expandedPaths сохраняй как было.
- Добавь в appState права текущего пользователя:
  - admin, canEdit
- После логина фронт должен узнать права:
  - добавь endpoint GET /api/me -> {login, admin, canEdit}
  - на основе canEdit скрывай/показывай кнопки и формы редактирования.

========================================
11) ТЕСТЫ (BACKEND) ДЛЯ НОВОЙ ИТЕРАЦИИ
========================================
Добавь/расширь тесты JUnit + MockMvc:
1) MeEndpointTest: /api/me возвращает флаги.
2) RBACReadOnlyTest:
   - пользователь canEdit=false может GET /api/tree и /api/exercises
   - но не может POST/PUT/DELETE на sections/exercises/files (403)
3) AdminEndpointsTest:
   - не-админ не может ходить в /api/admin/*
   - админ может:
     - добавить пользователя
     - поменять флаги
     - сменить пароль
     - удалить пользователя
     - запрет удаления последнего админа
4) ChangePasswordTest:
   - неверный oldPassword -> 400/403
   - верный -> пароль меняется в users.json
5) FileDescriptionTest:
   - после upload файл появляется с пустым description
   - PUT description сохраняет и возвращается в GET /api/exercises
6) UsersMigrationTest:
   - если есть users.txt и нет users.json -> создаётся users.json и ai становится admin+canEdit (если есть ai:1)
7) RootViewTest:
   - если selectedPath пустой -> правый view показывает корневые разделы (это больше фронт, но можно проверить, что /api/tree отдаёт root корректно)

Если фронт тестов нет — ок, но backend обязательно.

========================================
12) НЕ ЛОМАТЬ СУЩЕСТВУЮЩЕЕ
========================================
- Сохрани текущие endpoint’ы, если возможно.
- Добавляй новые аккуратно.
- Сохрани demo data генерацию.
- README.md обнови: права пользователей, users.json формат, админка, смена пароля, file descriptions.

СДЕЛАЙ ВСЕ ИЗМЕНЕНИЯ В ПРОЕКТЕ И УБЕДИСЬ, ЧТО ПРИЛОЖЕНИЕ СТАРТУЕТ И ТЕСТЫ ПРОХОДЯТ.
